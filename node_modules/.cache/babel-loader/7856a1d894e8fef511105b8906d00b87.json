{"ast":null,"code":"var _jsxFileName = \"/home/ketgintern/Desktop/FMS-AGV-AMR/frontend/src/components/WebcamStream.js\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport io from 'socket.io-client';\nconst WebcamStream = ({\n  selectedRobot\n}) => {\n  const videoRef = useRef(null);\n  const [peerConnection, setPeerConnection] = useState(null);\n  const socketRef = useRef(null);\n  useEffect(() => {\n    if (selectedRobot) {\n      socketRef.current = io('http://172.30.1.40:7001'); // WebRTC 서버 주소\n\n      const pc = new RTCPeerConnection({\n        iceServers: [{\n          urls: 'stun:stun.l.google.com:19302'\n        }, {\n          urls: 'stun:stun1.l.google.com:19302'\n        }]\n      });\n      pc.onicecandidate = event => {\n        if (event.candidate) {\n          console.log('New ICE candidate:', event.candidate);\n          socketRef.current.emit('candidate', event.candidate);\n        }\n      };\n      pc.ontrack = event => {\n        console.log('ontrack event:', event);\n        if (videoRef.current) {\n          videoRef.current.srcObject = event.streams[0];\n          console.log('srcObject set:', videoRef.current.srcObject);\n        } else {\n          console.log('videoRef.current is null');\n        }\n      };\n      pc.oniceconnectionstatechange = () => {\n        console.log('ICE Connection State Change:', pc.iceConnectionState);\n      };\n      pc.onconnectionstatechange = () => {\n        console.log('Connection State Change:', pc.connectionState);\n      };\n      socketRef.current.on('signal', async data => {\n        console.log('Received signal:', data);\n        if (data.type === 'offer') {\n          await pc.setRemoteDescription(new RTCSessionDescription(data));\n          const answer = await pc.createAnswer();\n          await pc.setLocalDescription(answer);\n          socketRef.current.emit('signal', pc.localDescription);\n        } else if (data.type === 'answer') {\n          await pc.setRemoteDescription(new RTCSessionDescription(data));\n        } else if (data.candidate) {\n          await pc.addIceCandidate(new RTCIceCandidate(data));\n        }\n      });\n      socketRef.current.emit('join');\n      setPeerConnection(pc);\n      return () => {\n        pc.close();\n        socketRef.current.disconnect();\n      };\n    }\n  }, [selectedRobot]);\n  useEffect(() => {\n    const currentVideoRef = videoRef.current;\n    console.log('Video ref:', currentVideoRef);\n    return () => {\n      if (currentVideoRef) {\n        currentVideoRef.srcObject = null;\n      }\n    };\n  }, []);\n  useEffect(() => {\n    console.log('videoRef:', videoRef.current);\n  }, [videoRef]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    ref: videoRef,\n    autoPlay: true,\n    playsInline: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }\n  }));\n};\nexport default WebcamStream;","map":{"version":3,"names":["React","useEffect","useRef","useState","io","WebcamStream","selectedRobot","videoRef","peerConnection","setPeerConnection","socketRef","current","pc","RTCPeerConnection","iceServers","urls","onicecandidate","event","candidate","console","log","emit","ontrack","srcObject","streams","oniceconnectionstatechange","iceConnectionState","onconnectionstatechange","connectionState","on","data","type","setRemoteDescription","RTCSessionDescription","answer","createAnswer","setLocalDescription","localDescription","addIceCandidate","RTCIceCandidate","close","disconnect","currentVideoRef","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","playsInline"],"sources":["/home/ketgintern/Desktop/FMS-AGV-AMR/frontend/src/components/WebcamStream.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport io from 'socket.io-client';\n\nconst WebcamStream = ({ selectedRobot }) => {\n  const videoRef = useRef(null);\n  const [peerConnection, setPeerConnection] = useState(null);\n  const socketRef = useRef(null);\n\n  useEffect(() => {\n    if (selectedRobot) {\n      socketRef.current = io('http://172.30.1.40:7001'); // WebRTC 서버 주소\n\n      const pc = new RTCPeerConnection({\n        iceServers: [\n          { urls: 'stun:stun.l.google.com:19302' },\n          { urls: 'stun:stun1.l.google.com:19302' }\n        ]\n      });\n\n      pc.onicecandidate = (event) => {\n        if (event.candidate) {\n          console.log('New ICE candidate:', event.candidate);\n          socketRef.current.emit('candidate', event.candidate);\n        }\n      };\n\n      pc.ontrack = (event) => {\n        console.log('ontrack event:', event);\n        if (videoRef.current) {\n          videoRef.current.srcObject = event.streams[0];\n          console.log('srcObject set:', videoRef.current.srcObject);\n        } else {\n          console.log('videoRef.current is null');\n        }\n      };\n\n      pc.oniceconnectionstatechange = () => {\n        console.log('ICE Connection State Change:', pc.iceConnectionState);\n      };\n\n      pc.onconnectionstatechange = () => {\n        console.log('Connection State Change:', pc.connectionState);\n      };\n\n      socketRef.current.on('signal', async (data) => {\n        console.log('Received signal:', data);\n        if (data.type === 'offer') {\n          await pc.setRemoteDescription(new RTCSessionDescription(data));\n          const answer = await pc.createAnswer();\n          await pc.setLocalDescription(answer);\n          socketRef.current.emit('signal', pc.localDescription);\n        } else if (data.type === 'answer') {\n          await pc.setRemoteDescription(new RTCSessionDescription(data));\n        } else if (data.candidate) {\n          await pc.addIceCandidate(new RTCIceCandidate(data));\n        }\n      });\n\n      socketRef.current.emit('join');\n\n      setPeerConnection(pc);\n\n      return () => {\n        pc.close();\n        socketRef.current.disconnect();\n      };\n    }\n  }, [selectedRobot]);\n\n  useEffect(() => {\n    const currentVideoRef = videoRef.current;\n    console.log('Video ref:', currentVideoRef);\n    return () => {\n      if (currentVideoRef) {\n        currentVideoRef.srcObject = null;\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    console.log('videoRef:', videoRef.current);\n  }, [videoRef]);\n\n  return (\n    <div>\n      <video ref={videoRef} autoPlay playsInline />\n    </div>\n  );\n};\n\nexport default WebcamStream;\n\n\n\n\n\n\n\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}