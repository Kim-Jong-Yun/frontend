{"ast":null,"code":"var _jsxFileName = \"/home/ketgintern/Desktop/FMS-AGV-AMR/frontend/src/pages/Test/TestPage.js\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport Navbar from '../../components/Common/Navbar';\nimport LogoutButton from '../../components/Common/LogoutButton';\nimport UserInfo from '../../components/Common/UserInfo';\nimport axios from 'axios';\nfunction TestPage() {\n  const [mapUrl, setMapUrl] = useState(null);\n  const [robots, setRobots] = useState([]);\n  const [tasks, setTasks] = useState([]);\n  const canvasRef = useRef(null);\n  const [mapResolution, setMapResolution] = useState(0.05); // 기본 값, 실제 파일에서 가져올 예정\n  const [mapDimensions, setMapDimensions] = useState({\n    width: 0,\n    height: 0\n  });\n  const [expandedRobotId, setExpandedRobotId] = useState(null); // 확장된 로봇 ID 저장\n\n  useEffect(() => {\n    const fetchData = async () => {\n      await fetchMapMetadata();\n      await fetchMonitoredMap();\n      fetchRobots(); // 로봇 리스트 API 호출\n      fetchAllTasks(); // 모든 작업 로그 API 호출\n    };\n    fetchData();\n\n    // WebSocket 연결 설정\n    const socket = new WebSocket('ws://your-websocket-url'); // WebSocket 주소를 설정하세요\n\n    socket.onopen = () => {\n      console.log('WebSocket 연결 성공');\n    };\n    socket.onmessage = event => {\n      const updatedRobots = JSON.parse(event.data);\n      setRobots(updatedRobots); // WebSocket으로 받은 데이터를 로봇 상태로 설정\n    };\n    socket.onerror = error => {\n      console.error('WebSocket 오류:', error);\n    };\n    socket.onclose = () => {\n      console.log('WebSocket 연결 종료');\n    };\n    return () => {\n      socket.close(); // 컴포넌트가 언마운트되면 WebSocket 연결 종료\n    };\n  }, []);\n  const getToken = () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      alert('토큰이 없습니다. 다시 로그인해주세요.');\n      window.location.href = '/login'; // 토큰이 없으면 로그인 페이지로 리디렉션\n      return null;\n    }\n    return token;\n  };\n  const fetchMonitoredMap = async () => {\n    const token = getToken();\n    if (!token) return;\n    try {\n      const response = await axios.get('http://172.30.1.28:5557/map/monitored/file', {\n        headers: {\n          Authorization: `Bearer ${token}`\n        },\n        responseType: 'blob'\n      });\n      const url = URL.createObjectURL(response.data);\n      setMapUrl(url);\n      const img = new Image();\n      img.src = url;\n      img.onload = () => {\n        setMapDimensions({\n          width: img.width,\n          height: img.height\n        });\n        drawMapAndRobots(img.width, img.height); // 이미지 크기대로 캔버스 조정 및 그리기\n      };\n      img.onerror = err => {\n        console.error('지도 이미지를 로드하는 중 오류 발생:', err);\n      };\n    } catch (error) {\n      console.error('모니터링 지도 가져오기 오류:', error);\n    }\n  };\n  const fetchMapMetadata = async () => {\n    const token = getToken();\n    if (!token) return;\n    try {\n      const response = await axios.get('http://172.30.1.28:5557/map/monitored/metadata', {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      const metadata = response.data;\n      const resolution = parseFloat(metadata.match(/resolution:\\s*(\\d+.\\d+)/)[1]);\n      setMapResolution(resolution);\n    } catch (error) {\n      console.error('지도 메타데이터 가져오기 오류:', error);\n    }\n  };\n  const fetchAllTasks = async () => {\n    console.log('모든 작업 로그 가져오는 중');\n    const token = getToken();\n    if (!token) {\n      console.log('토큰이 없어 fetchAllTasks 종료');\n      return;\n    }\n    try {\n      const response = await axios.get('http://172.30.1.28:8080/task/all', {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setTasks(response.data); // 모든 작업 데이터를 상태로 설정\n    } catch (error) {\n      console.error('작업 로그 가져오기 오류:', error);\n    }\n  };\n  const fetchRobots = async () => {\n    console.log('로봇 정보 가져오는 중');\n    const token = getToken();\n    if (!token) {\n      console.log('토큰이 없어 fetchRobots 종료');\n      return;\n    }\n    try {\n      const response = await axios.get('http://172.30.1.28:5559/robot/robots', {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setRobots(response.data);\n    } catch (error) {\n      console.error('로봇 정보 가져오기 오류:', error);\n    }\n  };\n  const toggleExpand = robotId => {\n    // 같은 로봇을 누르면 접히고, 다른 로봇을 누르면 확장되게 설정\n    if (expandedRobotId === robotId) {\n      setExpandedRobotId(null);\n    } else {\n      setExpandedRobotId(robotId);\n    }\n  };\n  const drawMapAndRobots = (imgWidth, imgHeight) => {\n    const canvas = canvasRef.current;\n    if (!canvas) {\n      console.error('캔버스 요소를 찾을 수 없습니다.');\n      return;\n    }\n    const ctx = canvas.getContext('2d');\n    const mapImage = new Image();\n    mapImage.src = mapUrl;\n    mapImage.onload = () => {\n      // 캔버스 크기를 이미지 크기로 조정\n      canvas.width = imgWidth;\n      canvas.height = imgHeight;\n\n      // 이미지 그리기\n      ctx.drawImage(mapImage, 0, 0, imgWidth, imgHeight);\n\n      // 로봇 위치 표시\n      robots.forEach(robot => {\n        var _robot$status, _robot$status2, _robot$status3;\n        const {\n          x,\n          y\n        } = robot.location;\n        const {\n          mapX,\n          mapY\n        } = worldToMap(x, y, imgWidth, imgHeight, mapResolution);\n\n        // 로봇 상태에 따른 색상 설정\n        let robotColor = 'gray'; // 기본값: None 상태인 경우\n        if (((_robot$status = robot.status) === null || _robot$status === void 0 ? void 0 : _robot$status.state) === 'Tasking') {\n          robotColor = 'blue'; // Tasking 상태: 파랑\n        } else if (((_robot$status2 = robot.status) === null || _robot$status2 === void 0 ? void 0 : _robot$status2.state) === 'Waiting') {\n          robotColor = 'yellow'; // Waiting 상태: 노랑\n        } else if (((_robot$status3 = robot.status) === null || _robot$status3 === void 0 ? void 0 : _robot$status3.state) === 'Error') {\n          robotColor = 'red'; // Error 상태: 빨강\n        }\n\n        // 로봇 위치에 원 그리기\n        ctx.fillStyle = robotColor;\n        ctx.beginPath();\n        ctx.arc(mapX, mapY, 5, 0, 2 * Math.PI);\n        ctx.fill();\n      });\n    };\n    mapImage.onerror = err => {\n      console.error('지도 이미지를 그리는 중 오류 발생:', err);\n    };\n  };\n  const worldToMap = (x, y, mapWidth, mapHeight, resolution) => {\n    const mapX = (x + mapWidth * resolution / 2) / resolution;\n    const mapY = mapHeight - (y + mapHeight * resolution / 2) / resolution;\n    return {\n      mapX,\n      mapY\n    };\n  };\n\n  // 날짜 형식 변환 또는 유효하지 않을 경우 \"N/A\" 표시\n  const formatDate = date => {\n    const parsedDate = new Date(date);\n    return isNaN(parsedDate) ? 'N/A' : parsedDate.toLocaleString();\n  };\n  useEffect(() => {\n    if (mapUrl && mapDimensions.width && mapDimensions.height) {\n      drawMapAndRobots(mapDimensions.width, mapDimensions.height);\n    }\n  }, [mapUrl, robots, mapDimensions]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      fontFamily: 'Arial, sans-serif',\n      margin: '20px',\n      position: 'relative',\n      minHeight: '100vh'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"header\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'space-between',\n      marginBottom: '20px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(UserInfo, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(LogoutButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Navbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"h1\", {\n    style: {\n      textAlign: 'center',\n      margin: '20px 0'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      flexGrow: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      flex: 3,\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginRight: '20px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 9\n    }\n  }, mapUrl ? /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      border: '1px solid #ccc'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 13\n    }\n  }) : /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 13\n    }\n  }, \"\\uC9C0\\uB3C4\\uB97C \\uBD88\\uB7EC\\uC624\\uB294 \\uC911...\")), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      flex: 1,\n      padding: '20px',\n      borderLeft: '1px solid #ccc',\n      overflowY: 'auto',\n      maxHeight: '80vh'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 11\n    }\n  }, \"\\uB85C\\uBD07 \\uB9AC\\uC2A4\\uD2B8\"), /*#__PURE__*/React.createElement(\"ul\", {\n    style: {\n      listStyleType: 'none',\n      padding: 0\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 11\n    }\n  }, robots.length > 0 ? robots.map(robot => {\n    var _robot$status4, _robot$status5;\n    return /*#__PURE__*/React.createElement(\"li\", {\n      key: robot._id,\n      style: {\n        marginBottom: '10px',\n        borderBottom: '1px solid #ddd',\n        padding: '10px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 23\n      }\n    }, \"\\uC774\\uB984:\"), \" \", robot.name), /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 23\n      }\n    }, \"\\uC0C1\\uD0DC:\"), \" \", ((_robot$status4 = robot.status) === null || _robot$status4 === void 0 ? void 0 : _robot$status4.state) || 'Unknown'), /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 23\n      }\n    }, \"\\uBC30\\uD130\\uB9AC:\"), \" \", ((_robot$status5 = robot.status) === null || _robot$status5 === void 0 ? void 0 : _robot$status5.battery) || 'N/A', \"%\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => toggleExpand(robot._id),\n      style: {\n        background: 'none',\n        border: 'none',\n        cursor: 'pointer',\n        fontSize: '16px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 21\n      }\n    }, expandedRobotId === robot._id ? '^' : 'v')), expandedRobotId === robot._id && /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        marginTop: '10px',\n        padding: '10px',\n        backgroundColor: '#f9f9f9'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 23\n      }\n    }, \"\\uC5EC\\uAE30\\uC5D0 \\uB85C\\uBD07\\uC758 \\uC138\\uBD80 \\uC815\\uBCF4\\uAC00 \\uB4E4\\uC5B4\\uAC08 \\uC608\\uC815\\uC785\\uB2C8\\uB2E4.\")));\n  }) : /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 15\n    }\n  }, \"\\uC5F0\\uACB0\\uB41C \\uB85C\\uBD07\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\")))), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: 'calc(99% - 500px)',\n      // 모니터링 맵과 일치하게 만듦, 500px은 로봇 리스트 영역\n      padding: '10px 20px',\n      marginTop: '20px',\n      borderTop: '1px solid #ccc',\n      height: '25vh',\n      backgroundColor: '#f9f9f9',\n      overflowY: 'auto' // 'fix'에서 'auto'로 변경\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 9\n    }\n  }, \"\\uC791\\uC5C5 \\uB85C\\uADF8\"), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      height: '80%',\n      overflowY: 'scroll',\n      border: '1px solid #ccc'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"table\", {\n    style: {\n      width: '100%',\n      borderCollapse: 'collapse'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"thead\", {\n    style: {\n      position: 'sticky',\n      top: 0,\n      backgroundColor: '#f9f9f9',\n      zIndex: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"th\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 17\n    }\n  }, \"\\uC791\\uC5C5 \\uC774\\uB984\"), /*#__PURE__*/React.createElement(\"th\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 17\n    }\n  }, \"\\uB85C\\uBD07 IP\"), /*#__PURE__*/React.createElement(\"th\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 17\n    }\n  }, \"\\uC791\\uC5C5 \\uC720\\uD615\"), /*#__PURE__*/React.createElement(\"th\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 17\n    }\n  }, \"\\uC0C1\\uD0DC\"), /*#__PURE__*/React.createElement(\"th\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 17\n    }\n  }, \"\\uC2DC\\uC791 \\uC2DC\\uAC04\"), /*#__PURE__*/React.createElement(\"th\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 17\n    }\n  }, \"\\uC885\\uB8CC \\uC2DC\\uAC04\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 13\n    }\n  }, tasks.length > 0 ? tasks.map((task, index) => /*#__PURE__*/React.createElement(\"tr\", {\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 21\n    }\n  }, task.name), /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 21\n    }\n  }, task.robotIp), /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 21\n    }\n  }, task.taskType), /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 21\n    }\n  }, task.status), /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 21\n    }\n  }, formatDate(task.startTime)), /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      border: '1px solid #ccc',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 21\n    }\n  }, formatDate(task.endTime)))) : /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    colSpan: \"6\",\n    style: {\n      textAlign: 'center',\n      padding: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 19\n    }\n  }, \"\\uC791\\uC5C5 \\uB85C\\uADF8\\uAC00 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\")))))));\n}\nexport default TestPage;","map":{"version":3,"names":["React","useState","useEffect","useRef","Navbar","LogoutButton","UserInfo","axios","TestPage","mapUrl","setMapUrl","robots","setRobots","tasks","setTasks","canvasRef","mapResolution","setMapResolution","mapDimensions","setMapDimensions","width","height","expandedRobotId","setExpandedRobotId","fetchData","fetchMapMetadata","fetchMonitoredMap","fetchRobots","fetchAllTasks","socket","WebSocket","onopen","console","log","onmessage","event","updatedRobots","JSON","parse","data","onerror","error","onclose","close","getToken","token","localStorage","getItem","alert","window","location","href","response","get","headers","Authorization","responseType","url","URL","createObjectURL","img","Image","src","onload","drawMapAndRobots","err","metadata","resolution","parseFloat","match","toggleExpand","robotId","imgWidth","imgHeight","canvas","current","ctx","getContext","mapImage","drawImage","forEach","robot","_robot$status","_robot$status2","_robot$status3","x","y","mapX","mapY","worldToMap","robotColor","status","state","fillStyle","beginPath","arc","Math","PI","fill","mapWidth","mapHeight","formatDate","date","parsedDate","Date","isNaN","toLocaleString","createElement","style","fontFamily","margin","position","minHeight","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","display","justifyContent","marginBottom","textAlign","flexGrow","flex","alignItems","marginRight","ref","border","padding","borderLeft","overflowY","maxHeight","listStyleType","length","map","_robot$status4","_robot$status5","key","_id","borderBottom","name","battery","onClick","background","cursor","fontSize","marginTop","backgroundColor","borderTop","borderCollapse","top","zIndex","task","index","robotIp","taskType","startTime","endTime","colSpan"],"sources":["/home/ketgintern/Desktop/FMS-AGV-AMR/frontend/src/pages/Test/TestPage.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport Navbar from '../../components/Common/Navbar';\nimport LogoutButton from '../../components/Common/LogoutButton';\nimport UserInfo from '../../components/Common/UserInfo';\nimport axios from 'axios';\n\nfunction TestPage() {\n  const [mapUrl, setMapUrl] = useState(null);\n  const [robots, setRobots] = useState([]);\n  const [tasks, setTasks] = useState([]);\n  const canvasRef = useRef(null);\n  const [mapResolution, setMapResolution] = useState(0.05); // 기본 값, 실제 파일에서 가져올 예정\n  const [mapDimensions, setMapDimensions] = useState({ width: 0, height: 0 });\n  const [expandedRobotId, setExpandedRobotId] = useState(null); // 확장된 로봇 ID 저장\n\n  useEffect(() => {\n    const fetchData = async () => {\n      await fetchMapMetadata();\n      await fetchMonitoredMap();\n      fetchRobots(); // 로봇 리스트 API 호출\n      fetchAllTasks(); // 모든 작업 로그 API 호출\n    };\n    fetchData();\n\n    // WebSocket 연결 설정\n    const socket = new WebSocket('ws://your-websocket-url'); // WebSocket 주소를 설정하세요\n\n    socket.onopen = () => {\n      console.log('WebSocket 연결 성공');\n    };\n\n    socket.onmessage = (event) => {\n      const updatedRobots = JSON.parse(event.data);\n      setRobots(updatedRobots); // WebSocket으로 받은 데이터를 로봇 상태로 설정\n    };\n\n    socket.onerror = (error) => {\n      console.error('WebSocket 오류:', error);\n    };\n\n    socket.onclose = () => {\n      console.log('WebSocket 연결 종료');\n    };\n\n    return () => {\n      socket.close(); // 컴포넌트가 언마운트되면 WebSocket 연결 종료\n    };\n  }, []);\n\n  const getToken = () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      alert('토큰이 없습니다. 다시 로그인해주세요.');\n      window.location.href = '/login'; // 토큰이 없으면 로그인 페이지로 리디렉션\n      return null;\n    }\n    return token;\n  };\n\n  const fetchMonitoredMap = async () => {\n    const token = getToken();\n    if (!token) return;\n\n    try {\n      const response = await axios.get('http://172.30.1.28:5557/map/monitored/file', {\n        headers: { Authorization: `Bearer ${token}` },\n        responseType: 'blob',\n      });\n      const url = URL.createObjectURL(response.data);\n      setMapUrl(url);\n\n      const img = new Image();\n      img.src = url;\n      img.onload = () => {\n        setMapDimensions({ width: img.width, height: img.height });\n        drawMapAndRobots(img.width, img.height); // 이미지 크기대로 캔버스 조정 및 그리기\n      };\n      img.onerror = (err) => {\n        console.error('지도 이미지를 로드하는 중 오류 발생:', err);\n      };\n    } catch (error) {\n      console.error('모니터링 지도 가져오기 오류:', error);\n    }\n  };\n\n  const fetchMapMetadata = async () => {\n    const token = getToken();\n    if (!token) return;\n\n    try {\n      const response = await axios.get('http://172.30.1.28:5557/map/monitored/metadata', {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      const metadata = response.data;\n      const resolution = parseFloat(metadata.match(/resolution:\\s*(\\d+.\\d+)/)[1]);\n      setMapResolution(resolution);\n    } catch (error) {\n      console.error('지도 메타데이터 가져오기 오류:', error);\n    }\n  };\n\n  const fetchAllTasks = async () => {\n    console.log('모든 작업 로그 가져오는 중');\n    const token = getToken();\n    if (!token) {\n      console.log('토큰이 없어 fetchAllTasks 종료');\n      return;\n    }\n\n    try {\n      const response = await axios.get('http://172.30.1.28:8080/task/all', {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      });\n      setTasks(response.data); // 모든 작업 데이터를 상태로 설정\n    } catch (error) {\n      console.error('작업 로그 가져오기 오류:', error);\n    }\n  };\n\n  const fetchRobots = async () => {\n    console.log('로봇 정보 가져오는 중');\n    const token = getToken();\n    if (!token) {\n      console.log('토큰이 없어 fetchRobots 종료');\n      return;\n    }\n\n    try {\n      const response = await axios.get('http://172.30.1.28:5559/robot/robots', {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      });\n      setRobots(response.data);\n    } catch (error) {\n      console.error('로봇 정보 가져오기 오류:', error);\n    }\n  };\n\n  const toggleExpand = (robotId) => {\n    // 같은 로봇을 누르면 접히고, 다른 로봇을 누르면 확장되게 설정\n    if (expandedRobotId === robotId) {\n      setExpandedRobotId(null);\n    } else {\n      setExpandedRobotId(robotId);\n    }\n  };\n\n  const drawMapAndRobots = (imgWidth, imgHeight) => {\n    const canvas = canvasRef.current;\n    if (!canvas) {\n      console.error('캔버스 요소를 찾을 수 없습니다.');\n      return;\n    }\n\n    const ctx = canvas.getContext('2d');\n    const mapImage = new Image();\n    mapImage.src = mapUrl;\n\n    mapImage.onload = () => {\n      // 캔버스 크기를 이미지 크기로 조정\n      canvas.width = imgWidth;\n      canvas.height = imgHeight;\n\n      // 이미지 그리기\n      ctx.drawImage(mapImage, 0, 0, imgWidth, imgHeight);\n\n      // 로봇 위치 표시\n      robots.forEach((robot) => {\n        const { x, y } = robot.location;\n        const { mapX, mapY } = worldToMap(x, y, imgWidth, imgHeight, mapResolution);\n\n        // 로봇 상태에 따른 색상 설정\n        let robotColor = 'gray'; // 기본값: None 상태인 경우\n        if (robot.status?.state === 'Tasking') {\n          robotColor = 'blue'; // Tasking 상태: 파랑\n        } else if (robot.status?.state === 'Waiting') {\n          robotColor = 'yellow'; // Waiting 상태: 노랑\n        } else if (robot.status?.state === 'Error') {\n          robotColor = 'red'; // Error 상태: 빨강\n        }\n\n        // 로봇 위치에 원 그리기\n        ctx.fillStyle = robotColor;\n        ctx.beginPath();\n        ctx.arc(mapX, mapY, 5, 0, 2 * Math.PI);\n        ctx.fill();\n      });\n    };\n\n    mapImage.onerror = (err) => {\n      console.error('지도 이미지를 그리는 중 오류 발생:', err);\n    };\n  };\n\n  const worldToMap = (x, y, mapWidth, mapHeight, resolution) => {\n    const mapX = (x + (mapWidth * resolution) / 2) / resolution;\n    const mapY = mapHeight - (y + (mapHeight * resolution) / 2) / resolution;\n    return { mapX, mapY };\n  };\n\n  // 날짜 형식 변환 또는 유효하지 않을 경우 \"N/A\" 표시\n  const formatDate = (date) => {\n    const parsedDate = new Date(date);\n    return isNaN(parsedDate) ? 'N/A' : parsedDate.toLocaleString();\n  };\n\n  useEffect(() => {\n    if (mapUrl && mapDimensions.width && mapDimensions.height) {\n      drawMapAndRobots(mapDimensions.width, mapDimensions.height);\n    }\n  }, [mapUrl, robots, mapDimensions]);\n\n  return (\n    <div\n      style={{\n        fontFamily: 'Arial, sans-serif',\n        margin: '20px',\n        position: 'relative',\n        minHeight: '100vh',\n      }}\n    >\n      <header style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>\n        <UserInfo />\n        <LogoutButton />\n      </header>\n      <Navbar />\n      <h1 style={{ textAlign: 'center', margin: '20px 0' }}></h1>\n      <div style={{ display: 'flex', flexGrow: 1 }}>\n        {/* 좌측 - 지도 캔버스 */}\n        <div\n          style={{\n            flex: 3,\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            marginRight: '20px',\n          }}\n        >\n          {mapUrl ? (\n            <canvas ref={canvasRef} style={{ border: '1px solid #ccc' }}></canvas>\n          ) : (\n            <p>지도를 불러오는 중...</p>\n          )}\n        </div>\n\n        {/* 우측 - 로봇 리스트 */}\n        <div\n          style={{\n            flex: 1,\n            padding: '20px',\n            borderLeft: '1px solid #ccc',\n            overflowY: 'auto',\n            maxHeight: '80vh',\n          }}\n        >\n          <h3>로봇 리스트</h3>\n          <ul style={{ listStyleType: 'none', padding: 0 }}>\n            {robots.length > 0 ? (\n              robots.map((robot) => (\n                <li\n                  key={robot._id}\n                  style={{\n                    marginBottom: '10px',\n                    borderBottom: '1px solid #ddd',\n                    padding: '10px',\n                  }}\n                >\n                  <div\n                    style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}\n                  >\n                    <span>\n                      <strong>이름:</strong> {robot.name}\n                    </span>\n                    <span>\n                      <strong>상태:</strong> {robot.status?.state || 'Unknown'}\n                    </span>\n                    <span>\n                      <strong>배터리:</strong> {robot.status?.battery || 'N/A'}%\n                    </span>\n                    {/* 버튼 추가 - 로봇 세부 정보 확장/축소 */}\n                    <button\n                      onClick={() => toggleExpand(robot._id)}\n                      style={{\n                        background: 'none',\n                        border: 'none',\n                        cursor: 'pointer',\n                        fontSize: '16px',\n                      }}\n                    >\n                      {expandedRobotId === robot._id ? '^' : 'v'}\n                    </button>\n                  </div>\n                  {/* 세부 정보 표시 */}\n                  {expandedRobotId === robot._id && (\n                    <div style={{ marginTop: '10px', padding: '10px', backgroundColor: '#f9f9f9' }}>\n                      <p>여기에 로봇의 세부 정보가 들어갈 예정입니다.</p>\n                    </div>\n                  )}\n                </li>\n              ))\n            ) : (\n              <p>연결된 로봇이 없습니다.</p>\n            )}\n          </ul>\n        </div>\n      </div>\n\n      {/* 작업 로그 섹션 */}\n      <div\n        style={{\n          width: 'calc(99% - 500px)', // 모니터링 맵과 일치하게 만듦, 500px은 로봇 리스트 영역\n          padding: '10px 20px',\n          marginTop: '20px',\n          borderTop: '1px solid #ccc',\n          height: '25vh',\n          backgroundColor: '#f9f9f9',\n          overflowY: 'auto', // 'fix'에서 'auto'로 변경\n        }}\n      >\n        <h3>작업 로그</h3>\n        <div style={{ height: '80%', overflowY: 'scroll', border: '1px solid #ccc' }}>\n          <table style={{ width: '100%', borderCollapse: 'collapse' }}>\n            <thead\n              style={{\n                position: 'sticky',\n                top: 0,\n                backgroundColor: '#f9f9f9',\n                zIndex: 1,\n              }}\n            >\n              <tr>\n                <th style={{ border: '1px solid #ccc', padding: '10px' }}>작업 이름</th>\n                <th style={{ border: '1px solid #ccc', padding: '10px' }}>로봇 IP</th>\n                <th style={{ border: '1px solid #ccc', padding: '10px' }}>작업 유형</th>\n                <th style={{ border: '1px solid #ccc', padding: '10px' }}>상태</th>\n                <th style={{ border: '1px solid #ccc', padding: '10px' }}>시작 시간</th>\n                <th style={{ border: '1px solid #ccc', padding: '10px' }}>종료 시간</th>\n              </tr>\n            </thead>\n            <tbody>\n              {tasks.length > 0 ? (\n                tasks.map((task, index) => (\n                  <tr key={index}>\n                    <td style={{ border: '1px solid #ccc', padding: '10px' }}>{task.name}</td>\n                    <td style={{ border: '1px solid #ccc', padding: '10px' }}>{task.robotIp}</td>\n                    <td style={{ border: '1px solid #ccc', padding: '10px' }}>{task.taskType}</td>\n                    <td style={{ border: '1px solid #ccc', padding: '10px' }}>{task.status}</td>\n                    <td style={{ border: '1px solid #ccc', padding: '10px' }}>\n                      {formatDate(task.startTime)}\n                    </td>\n                    <td style={{ border: '1px solid #ccc', padding: '10px' }}>\n                      {formatDate(task.endTime)}\n                    </td>\n                  </tr>\n                ))\n              ) : (\n                <tr>\n                  <td colSpan=\"6\" style={{ textAlign: 'center', padding: '10px' }}>\n                    작업 로그가 없습니다.\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default TestPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}